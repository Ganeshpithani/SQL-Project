create database grocery_store;
use grocery_store;
-- 1. Supplier Table
CREATE TABLE IF NOT EXISTS supplier (
    sup_id TINYINT PRIMARY KEY,
    sup_name VARCHAR(255),
    address TEXT
);
-- 2. Categories Table
CREATE TABLE IF NOT EXISTS categories (
    cat_id TINYINT PRIMARY KEY,
    cat_name VARCHAR(255)
);
-- 3. Employees Table
CREATE TABLE IF NOT EXISTS employees (
    emp_id TINYINT PRIMARY KEY,
    emp_name VARCHAR(255),
    hire_date VARCHAR(255)
);
-- 4. Customers Table
CREATE TABLE IF NOT EXISTS customers (
    cust_id SMALLINT PRIMARY KEY,
    cust_name VARCHAR(255),
    address TEXT
);
-- 5. Products Table
CREATE TABLE IF NOT EXISTS products (
    prod_id TINYINT PRIMARY KEY,
    prod_name VARCHAR(255),
    sup_id TINYINT,
    cat_id TINYINT,
    price DECIMAL(10,2),
    FOREIGN KEY (sup_id) REFERENCES supplier(sup_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (cat_id) REFERENCES categories(cat_id)
        ON UPDATE CASCADE ON DELETE CASCADE
);
-- 6. Orders Table
CREATE TABLE IF NOT EXISTS orders (
    ord_id SMALLINT PRIMARY KEY,
    cust_id SMALLINT,
    emp_id TINYINT,
    order_date VARCHAR(255),
    FOREIGN KEY (cust_id) REFERENCES customers(cust_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (emp_id) REFERENCES employees(emp_id)
        ON UPDATE CASCADE ON DELETE CASCADE
);
-- 7. Order_Details Table
CREATE TABLE IF NOT EXISTS order_details (
    ord_detID SMALLINT AUTO_INCREMENT PRIMARY KEY,
    ord_id SMALLINT,
    prod_id TINYINT,
    quantity TINYINT,
    each_price DECIMAL(10,2),
    total_price DECIMAL(10,2),
    FOREIGN KEY (ord_id) REFERENCES orders(ord_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (prod_id) REFERENCES products(prod_id)
        ON UPDATE CASCADE ON DELETE CASCADE
);


select * from customers;
select * from orders;
select * from order_details;
select * from employees;
select * from products;
select * from supplier;
select * from categories;

describe customers;
describe orders;
describe order_details;
describe employees;
describe products;
describe supplier;
describe categories;


-- Analysis Questions
-- A. Customer Insights
--  1.How many unique customers have placed orders?
select count(distinct cust_id) as unique_customers
from orders;

-- 2.Which customers have placed the highest number of orders?
select c.cust_id, c.cust_name, count(o.ord_id) as total_orders
from customers c
join orders o on c.cust_id = o.cust_id
group by c.cust_id
order by total_orders desc
limit 1;

-- 3.What is the total and average purchase value per customer?
select
    o.cust_id,
    c.cust_name,
    sum(od.total_price) as total_purchase,
    avg(od.total_price) as avg_purchase
from orders o
join order_details od on o.ord_id = od.ord_id
join customers c on o.cust_id = c.cust_id
group by o.cust_id;

-- 4.Who are the top 5 customers by total purchase amount?
select o.cust_id, c.cust_name, sum(od.total_price) as total_purchase
from orders o
join order_details od on o.ord_id = od.ord_id
join customers c on o.cust_id = c.cust_id
group by o.cust_id
order by total_purchase desc
limit 5;

----- B. Product Performance -------
-- 5.How many products exist in each category?
select c.cat_id,c.cat_name, count(p.prod_id) as total_products
from categories c
left join products p on c.cat_id = p.cat_id
group by c.cat_id;


-- 6.What is the average price of products by category?
select
    c.cat_id,
    c.cat_name,
    avg(p.price) as avg_price
from categories c
left join products p on c.cat_id = p.cat_id
group by c.cat_id;

-- 7.Which products have the highest total sales volume (by quantity)?
select p.prod_name, sum(od.quantity) as total_quantity_sold
from products p
join order_details od on p.prod_id = od.prod_id
group by p.prod_name
order by total_quantity_sold desc;

-- 8.What is the total revenue generated by each product?
select
    p.prod_name,
    sum(od.total_price) as total_revenue
from order_details od
left join products p on od.prod_id = p.prod_id
group by p.prod_name;

-- 9.How do product sales vary by category and supplier?
select
    c.cat_name,
    s.sup_name,
    sum(o.total_price) as total_sales
from order_details o
join products p on o.prod_id = p.prod_id
join categories c on p.cat_id = c.cat_id
join supplier s on p.sup_id = s.sup_id
group by c.cat_name, s.sup_name
order by c.cat_name, total_sales desc;

-- C. Sales and Order Trends
-- 10.How many orders have been placed in total?
select count(*) as total_orders
from orders;


-- 11.What is the average value per order?
select sum(total_price) / count(distinct ord_id) as avg_order_value
from order_details;


-- 12.On which dates were the most orders placed?
select order_date, count(*) as total_orders
from orders
group by order_date
order by total_orders desc
limit 1;


-- 13.What are the monthly trends in order volume and revenue?
select
    left(o.order_date, 7) as order_month,
    count(distinct o.ord_id) as order_volume,
    sum(od.total_price) as total_revenue
from orders o
join order_details od on o.ord_id = od.ord_id
group by order_month
order by order_month;

-- 14.How do order patterns vary across weekdays and weekends?
update orders
set order_date = date_format(str_to_date(order_date, '%m/%d/%Y'), '%Y-%m-%d');
select 
   dayname(str_to_date(order_date, '%Y-%m-%d')) as weekday,
    monthname(str_to_date(order_date, '%Y-%m-%d')) as month,
    count(ord_id) as total_orders
from orders
group by weekday, month
order by weekday, month;




-- D. Supplier Contribution
-- 15.How many suppliers are there in the database?
select count(*) as total_suppliers from supplier;

-- 16.Which supplier provides the most products?
select
    s.sup_id,
    s.sup_name,
    count(p.prod_id) as product_count
from supplier s
join products p on s.sup_id = p.sup_id
group by s.sup_id
order by product_count desc
limit 1;

-- 17.What is the average price of products from each supplier?
select
    s.sup_id,
    s.sup_name,
    avg(p.price) as avg_price
from products p
join supplier s on s.sup_id = p.sup_id
group by s.sup_id;

-- 18.Which suppliers contribute the most to total product sales (by revenue)?
select
    s.sup_id,
    s.sup_name,
    sum(od.total_price) as total_revenue
from supplier s
join products p on s.sup_id = p.sup_id
join order_details od on p.prod_id = od.prod_id
group by s.sup_id
order by total_revenue desc
limit 1;
-- E. Employee Performance
-- 19.How many employees have processed orders?
select count(distinct emp_id) as unique_employees from orders;

-- 20.Which employees have handled the most orders?
select
    e.emp_id,
    e.emp_name,
    count(o.ord_id) as ordered_most
from orders o
join employees e on o.emp_id = e.emp_id
group by e.emp_id
order by ordered_most desc
limit 1;

-- 21.What is the total sales value processed by each employee?
select
    e.emp_id,
    e.emp_name,
    sum(od.total_price) as total_sales
from employees e
join orders o on e.emp_id = o.emp_id
join order_details od on o.ord_id = od.ord_id
group by e.emp_id
order by total_sales desc;

-- 22.What is the average order value handled per employee?
select
    e.emp_id,
    e.emp_name,
    sum(od.total_price) / count(distinct o.ord_id) as avg_value
from employees e
join orders o on e.emp_id = o.emp_id
join order_details od on o.ord_id = od.ord_id
group by e.emp_id
order by avg_value desc;

-- F. Order Details Deep Dive
-- 23.What is the relationship between quantity ordered and total price?
select
    quantity,
    avg(od.total_price) as avg_total_price,
    count(*) as order_count
from order_details od
group by quantity
order by quantity;

-- 24.What is the average quantity ordered per product?
select
    p.prod_id,
    p.prod_name, 
    count(od.ord_id) as total_orders,
    avg(od.quantity) as avg_quantity_ordered
from products p
join order_details od on p.prod_id = od.prod_id
group by p.prod_id
order by avg_quantity_ordered desc;

-- 25.How does the unit price vary across products and orders?
select
    p.prod_id,
    p.prod_name,
    od.each_price as unit_price,
    count(od.ord_id) as times_ordered
from products p
join order_details od on p.prod_id = od.prod_id
group by p.prod_id, od.each_price
order by p.prod_id, od.each_price;


